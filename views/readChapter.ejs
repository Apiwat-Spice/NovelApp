<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>
        <%= novelName %> - Chapter <%= chapter.chapter_number %>
    </title>
    <style>
        body.light {
            background: #fff;
            color: #000;
        }

        body.dark {
            background: #121212;
            color: #e0e0e0;
        }

        body.sepia {
            background: #f4ecd8;
            color: #5b4636;
        }

        #controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        #content {
            line-height: 1.6;
            max-width: 700px;
            margin: auto;
            font-size: 18px;
        }

        .btn {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }

        .btn-primary {
            background: #007bff;
            color: #fff;
        }

        .btn-secondary {
            background: #6c757d;
            color: #fff;
        }
    </style>
</head>

<body class="light">
    <header>
        <h1>
            <%= novelName %>
        </h1>
    </header>

    <div id="reader" class="container mt-4">
        <div id="controls">
            <a href="/read/<%= chapter.novel_id %>" class="btn btn-primary">← Back</a>
            <button class="btn btn-secondary" onclick="changeFontSize(1)">A+</button>
            <button class="btn btn-secondary" onclick="changeFontSize(-1)">A-</button>
            <button class="btn btn-secondary" onclick="setTheme('light')">Light</button>
            <button class="btn btn-secondary" onclick="setTheme('dark')">Dark</button>
            <button class="btn btn-secondary" onclick="setTheme('sepia')">Sepia</button>
            <select id="fontSelect" onchange="changeFont(this.value)">
                <option value="serif">Serif</option>
                <option value="sans-serif">Sans-Serif</option>
                <option value="monospace">Monospace</option>
                <option value="Georgia">Georgia</option>
                <option value="Courier New">Courier New</option>
            </select>
        </div>

        <h2>Chapter <%= chapter.chapter_number %>: <%= chapter.title %>
        </h2>

        <div id="content">
            <%= chapter.content %>
        </div>

        <div class="d-flex justify-content-between mt-3">
            <% if (prevChapter) { %>
                <a href="/chapter/<%= prevChapter %>" class="btn btn-secondary">⬅ Previous</a>
                <% } else { %>
                    <span></span>
                    <% } %>

                        <% if (nextChapter) { %>
                            <a href="/chapter/<%= nextChapter %>" class="btn btn-secondary">Next ➡</a>
                            <% } else { %>
                                <span></span>
                                <% } %>
        </div>

        <hr>
        <h3>Comments</h3>
        <div>
            <% if (comments.length===0) { %>
                <p>No comments yet.</p>
                <% } else { %>
                    <% comments.forEach(c=> { %>
                        <div>
                            <strong>
                                <%= c.username %>
                            </strong>: <%= c.content %>
                                <small>(<%= new Date(c.created_at).toLocaleString() %>)</small>
                        </div>
                        <% }) %>
                            <% } %>
        </div>

        <% if (user) { %>
            <form method="POST" action="/chapter/<%= chapter.chapter_id %>/comment">
                <textarea name="content" rows="4" required></textarea>
                <button type="submit">Post Comment</button>
            </form>
            <% } else { %>
                <p><a href="/login">Login</a> to comment</p>
                <% } %>
    </div>

    <script>
        let fontSize = 18;

        function changeFontSize(change) {
            fontSize += change;
            if (fontSize < 12) fontSize = 12;
            document.getElementById("content").style.fontSize = fontSize + "px";
            localStorage.setItem("fontSize", fontSize);
        }

        function setTheme(theme) {
            document.body.className = theme;
            localStorage.setItem("theme", theme);
        }

        window.onload = function () {
            const savedFont = localStorage.getItem("fontSize");
            const savedTheme = localStorage.getItem("theme");

            if (savedFont) {
                fontSize = parseInt(savedFont);
                document.getElementById("content").style.fontSize = fontSize + "px";
            }
            if (savedTheme) {
                document.body.className = savedTheme;
            }
        }

        function changeFont(fontFamily) {
            document.getElementById("content").style.fontFamily = fontFamily;
        }
    </script>
</body>

</html>